# Makefile for MacroServer resource files

MBF_TOP = ../../..
include $(MBF_TOP)/Makefile.common

DSERVER_NAME = $(notdir $(shell pwd))

CONFIG_DIR = $(MBF_TOP)/sites/$(SITE)/iocs
CONFIGS = $(wildcard $(CONFIG_DIR)/*.config)
IOCS_RES = $(subst .config,.res,$(notdir $(CONFIGS)))

resource_files: $(IOCS_RES)
.PHONY: resource_files

%.res: $(CONFIG_DIR)/%.config
	if ../../tools/is_epics_conf $(CONFIG_DIR)/$*.config ; then make_res $(CONFIG_DIR)/$*.config >$@ ; fi
	if [ -f $@ ] ; then mv $@ ../resources/$(DSERVER_NAME)_$@ ; fi

clean:
	rm -f $(IOCS_RES)
.PHONY: clean
